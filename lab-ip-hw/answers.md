тут будут ответы на вопросы под главами 2 и 3

# Вопросы к главе 2
2)  Какое значение величины MTU установлено у интерфейса, связанного с сегментом Ethernet? У локального сетевого интерфейса?

-У интерфейса связанного с Ethernet 1500 у локального 16436

3) Почему при настройке сетевого интерфейса, помимо IP-адреса,
нужно указать и маску сети

- маску надо указывать где в ip адресе указан адрес сети
4) Чему в нашем случае равно значение TTL у созданных IP-пакетов?

-64

5) Что выведет команда ping 127.10.10.100? Связано ли это с историческими классами сетей?

- так как это loopback интерфейс, то сообщение, отправленное командой ping вернется на этот же интерфейс

6) Для чего служит протокол ARP? Сколько видов ARP-сообщений существует?

Arp служит для нахождения mac адреса по ip адресу. сколько видов хз

7) С каким интервалом и сколько раз наша машина повторяет попытки
найти MAC-адреса получателя при посылке одного IP-пакета?

если сделть ping с ws1 на ws2, то в tcpdump на ws2 будет такая штука
```
ws2:~# tcpdump -ne
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
15:45:12.079193 c2:57:e2:f3:3f:00 > ff:ff:ff:ff:ff:ff, ethertype ARP (0x0806), length 42: arp who-has 10.0.50.5 tell 10.0.50.1
15:45:13.077635 c2:57:e2:f3:3f:00 > ff:ff:ff:ff:ff:ff, ethertype ARP (0x0806), length 42: arp who-has 10.0.50.5 tell 10.0.50.1
15:45:14.077693 c2:57:e2:f3:3f:00 > ff:ff:ff:ff:ff:ff, ethertype ARP (0x0806), length 42: arp who-has 10.0.50.5 tell 10.0.50.1
```
отсюда видно что запросы повторяются 3 раза с интервалом в 1 секунду

8) На какие MAC-адреса отправляются запросы протокола ARP?

Обратите внимание на MAC-адрес получателя ARP-запроса: это
значение (ff:ff:ff:ff:ff:ff), очевидно, означает широковещательную рассылку кадра по всему сегменту сети. (стр 45 сразу после задания 8)

9) Попадают ли в кеш протокола ARP адреса из сети локального сетевого интерфейса?

после пинга на 127.0.0.1 и проверки кеша ip n, кеш оказался пустой 

10) Куда вкладывается ICMP-сообщение: в пакет IP или сразу в кадр
Ethernet? Куда вкладывается ARP-сообщение?

icpm сообщение вкладывается в ip пакет, а он уже вкладывается в кадр канального уровня. (стр 41) ARP является служебным протоколом и его сообщение помещается в кадр протокола канального уровня, где уже есть поля
для MAC-адресов отправителя и получателя. В сообщении протокола ARP эти поля могут использоваться в ряде случаев особым образом и не совпадать с такими же адресами в заголовке кадра.

11) Что такое эхо-запрос и эхо-ответ? Для чего нужен идентификатор
эхо-запроса?

про эхо запросы и эхо ответы на стр 40

Поле id содержит идентификатор эхо-запроса; при посылке ответа
в него помещается этот же идентификатор, по которому, вместе с номером последовательности, можно определить соответствие запроса и ответа. (стр 44)

12) Как машина ws1 узнаёт в проведенном опыте MAC-адрес машины
ws2? Как машина ws2 узнаёт MAC-адрес машины ws1?

Находится не адрес машины ws2 а адрес маршрутизатора в сети, к котоорй подключен ws1, таким образом по цепочке сообщение доходит до ws2. https://habr.com/ru/post/80364/ тут 4 пункта как происходит определение маршрута

13) В ARP-запросе есть, кроме MAC-адреса, и IP-адрес отправителя.
Для чего он используется машинами в данной главе?

Вероятно чтобы отправить сообщение обратно

14) Для чего нужна маршрутная таблица протокола IP? На каких компьютерах она присутствует?

С помощью этой таблицы можно решить, что следует делать с IPпакетом, не адресованным данному компьютеру лично: по адресу получателя пакета компьютер с поддержкой протокола IP может определить, какому маршрутизатору и через какой сетевой интерфейс следует переслать
IP-пакет. (стр 46)

15) Почему в нашей системе команда ping 10.0.0.33 выведет другое сообщения об ошибке, чем команда ping 10.10.100.22?

в первом случае сеть известна, но в ней нет машины с таким номером
```
ws1:~# ping 10.0.50.5 -c 1
PING 10.0.50.5 (10.0.50.5) 56(84) bytes of data.
From 10.0.20.2 icmp_seq=1 Destination Host Unreachable

--- 10.0.50.5 ping statistics ---
1 packets transmitted, 0 received, +1 errors, 100% packet loss, time 0ms

```

во втором случае неизвестна даже сеть
```
ws1:~# ping 10.0.50.5 -c 1
PING 10.0.50.5 (10.0.50.5) 56(84) bytes of data.
From 10.0.20.2 icmp_seq=1 Destination Host Unreachable

--- 10.0.50.5 ping statistics ---
1 packets transmitted, 0 received, +1 errors, 100% packet loss, time 0ms
```
# Вопросы к главе 3
1) Сколько кадров с запросами MAC-адреса отправляется через сетевой интерфейс за один сеанс протокола ARP: один единственный или по
одному на каждую машину сегмента?
2) Проверяет ли протокол IP контрольную сумму передаваемых данных?

Поле checksum содержит контрольную сумму заголовка пакета, причём
тело пакета не участвует в расчете суммы — проверка контрольной суммы
передаваемых данных не относится к функциям сетевого уровня в стеке
TCP/IP. (стр 52)

3) Какие столбцы есть в маршрутной таблице? Для чего и как она используется?

см prepare про маршрутные таблицы

4) Что такое маршрут и путь в случае IP-маршрутизации?

Далее мы будем под путём (англ. path) понимать последовательность маршрутизаторов, которые некоторый IP-пакет проходит при следовании от отправителя к получателю. Поскольку задача маршрутизации решается независимо каждым маршрутизатором, а таблица маршрутизации
может меняться в ходе его работы, то путь одного пакета может не совпадать с путём другого с теми же адресами получателя и отправителя. Возможность изменения пути между двумя получателями является важным
достоинством сетей TCP/IP. (стр 58)

про то как маршрутизатор выбирает маршрут тоже на 58 стр внизуы

5) Чем различаются прямая и косвенная IP-маршрутизация?
косвенная маршрутизация - маршрутизация более чем в 1 сегменте сети
прямая - в одном сегменте

6) Как используется указанный в маршруте IP-адрес при косвенной
маршрутизации?

для того чтобы понять находится ли ip-адрес получателя в том же сегменте сети что и ip-адрес отправителя

7) Какой адрес (MAC, IP, или оба) маршрутизатора будет фигурировать в маршрутизируемом сообщении при косвенной маршрутизации?
про это есть на стр 59 

Заметьте, что IP-адрес маршрутизатора (10.10.0.1) в самом маршрутизируемом пакете не фигурирует — он был использован только для получения
его MAC-адреса.
Таким образом, получателем кадра, в который вложен отправляемый на адрес 10.20.0.2 IP-пакет, является очередной маршрутизатор, поэтому показанный процесс называется косвенной маршрутизацией.

8) Какие адреса (MAC/IP, получатель/отправитель) изменятся в транзитном пакете при прохождении через маршрутизатор?

ip адреса получаетя и отправителя остаются неизменнымиы

9) Компьютер получил кадр, MAC-адрес отправителя которого находится в кеше ARP, но IP-адрес которого не совпадает с сохраненным в кеше. Следует ли изменить адрес в кеше, добавить в кеш новую запись, или
кеш менять не следует? Зависит ли это от IP-адреса отправителя полученного пакета?

думаю следует менять кеш

10) Может ли в маршрутной таблице некоторого компьютера быть указан адрес маршрутизатора, не являющегося его соседом,то есть не принадлежащий ни одной из непосредственно подключенных к компьютеру сетей?

Думаю нет, так как у компьютера нет интерфейса в сети, в которой находится компьютер, не являющийся соседом

11) Что происходит с таблицей маршрутизации при отключении сетевого интерфейса?
при отключении сетевого интерфейса он останется в таблице маршрутизации
```
r1:~# ifconfig eth1 down
r1:~# tcpdump -tne -i eth1
tcpdump: eth1: That device is not up
r1:~# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: teql0: <NOARP> mtu 1500 qdisc noop qlen 100
    link/void 
3: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast qlen 1000
    link/ether 0e:ab:f8:0c:10:4b brd ff:ff:ff:ff:ff:ff
    inet 10.0.20.1/24 brd 10.0.20.255 scope global eth0
    inet6 fe80::cab:f8ff:fe0c:104b/64 scope link 
       valid_lft forever preferred_lft forever
4: eth1: <BROADCAST,MULTICAST> mtu 1500 qdisc pfifo_fast qlen 1000
    link/ether fa:de:dc:30:96:57 brd ff:ff:ff:ff:ff:ff
    inet 10.0.10.1/24 brd 10.0.10.255 scope global eth1
```
про это есть на стр 61
если передать ping с ws1 на ws2 через отключенный интерфейс eth1 на r1
```
ws1:~# ping 10.0.50.2 -c 1
PING 10.0.50.2 (10.0.50.2) 56(84) bytes of data.

--- 10.0.50.2 ping statistics ---
1 packets transmitted, 0 received, 100% packet loss, time 0ms
```

12) IP-пакет отправляется с ws11 на r2 через r1 в сети на рисункe 3.1.
MAC-адреса каких интерфейсов будут указаны в полях получателя и отправителя кадров Ethernet, в которые будет вложен этот пакет?

13) Для чего служит поле TTL в заголовке пакета? C каким начальным
значением этого поля выходит пакет в нашем случае? При каком значении
этого поля пакет не пересылается маршрутизатором далее?

ttl - указывает колчество маршрутизаторов, через которое пройдет сообщение перед тем как вернется сообщение о истечении жизни пакета
изначальное значение 64
перестанет передаваться далее, когда ttl = 0

14) Какой принцип работы программы traceroute?

пункт 3.8 стр 63

15) Как при IP-маршрутизации используется протокол ICMP? Перечислите все случаи использования из данной главы.

в данной главе icmp сообщения используются в качестве полезной нагрузки,в случае любой иной полезной нагрузки все сообщения типа «время жизни истекло» всё равно будут, разумеется, сообщениями служебного протокола ICMP. 

16) В какой момент маршрутизатор понимает, что искомый IP-адрес отсутствует в сети?

предположу 2 варианта: 
1) что в момент когда у пакета кончается ttl
2) когда маршрутизатор проходится по своей маршрутной таблице и не находит там этот адрес и адрес по умолчанию

17) Кому отправляются ICMP-сообщения о недоступности сети и недостижимости узла?

отправителю icmp сообщения

18) Для чего нужна фрагментация IP-пакетов и как она работает?

IP-пакет передаeтся внутри ровно одного кадра протокола канального уровня. Если величина MTU сегмента сети не позволяет передать некоторый IP-пакет целиком, то необходимо разделить его на фрагменты (стр 64)

19) Как по заголовку IP-пакета можно понять, что он является фрагментом?

в заголовке пакета присутствует флаг MF

20) В опыте мы видим, что первый фрагмент получился чуть меньше,
чем позволяет MTU (572 байта против 576 байтов). С чем это связано?

???

21) Чем плоха фрагментация IP-пакетов? На чём основывается борьба с нею в этой работе?

???

22) Кто должен повторить данные, уничтоженные вместе с не подлежащим фрагментации пакетом?

Если этого не сделать, то отправляющая слишком большой пакет машина получит ICMP-сообщение о необходимости фрагментации, а пакет будет уничтожен. (стр 65)

23) Пакет с одним ICMP-сообщением был разбит на два фрагмента размером около 500 байт. Какие из фрагментов содержат IP-заголовок? ICMPзаголовок?

icmp заголовок есть только в первом фрагменте
ip заголовок есть в каждом фрагменте фрагменте
(стр 67)


24) Почему даже в случае использования PMTU в отправляемых пакетах-фрагментах не установлен флаг DF?
25) Может ли в сети TCP/IP путь между двумя узлами меняться с течением времени? Может ли величина MTU пути меняться также?